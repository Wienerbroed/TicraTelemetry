<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payloads by Event Type</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f9f9f9;
    }
    h1 {
      color: #333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
    tr:nth-child(even) {
      background-color: #fafafa;
    }
    .event-type {
      margin-top: 30px;
      font-size: 1.2em;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>Payloads by Event Type</h1>

    <label for="eventSelect"><strong>Select Event Type:</strong></label>
    <select id="eventSelect">
    <option value="">-- All Event Types --</option>
    </select>
  <div id="content"></div>

    <script>
        let payloadData = [];

        function renderEvents(filterEventType = '') {
            const container = document.getElementById('content');
            container.innerHTML = '';

            payloadData
            .filter(event => !filterEventType || event.event_type === filterEventType)
            .forEach(event => {
                const eventTitle = document.createElement('div');
                eventTitle.className = 'event-type';
                eventTitle.textContent = `Event Type: ${event.event_type}`;
                container.appendChild(eventTitle);

                const table = document.createElement('table');

                const header = table.insertRow();
                header.insertCell().textContent = 'Payload';
                header.insertCell().textContent = 'Count';

                event.payloads.forEach(payloadObj => {
                const row = table.insertRow();

                let payloadValue;
                if (payloadObj.payload === null) {
                    payloadValue = 'null';
                } else if (typeof payloadObj.payload === 'string') {
                    payloadValue = `"${payloadObj.payload}"`;
                } else {
                    payloadValue = payloadObj.payload;
                }

                row.insertCell().textContent = payloadValue;
                row.insertCell().textContent = payloadObj.count;
                });

                container.appendChild(table);
            });
        }

        async function loadPayloadData() {
            try {
            const response = await fetch('/payloadevent');
            payloadData = await response.json();

            const select = document.getElementById('eventSelect');

            payloadData.forEach(event => {
                const option = document.createElement('option');
                option.value = event.event_type;
                option.textContent = event.event_type;
                select.appendChild(option);
            });

            select.addEventListener('change', e => {
                renderEvents(e.target.value);
            });

            renderEvents(); // show all by default
            } catch (err) {
            console.error('Error fetching payload data:', err);
            document.getElementById('content').textContent = 'Failed to load data.';
            }
        }

        loadPayloadData();
    </script>

</body>
</html>
